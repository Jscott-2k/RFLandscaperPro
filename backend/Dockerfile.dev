 # syntax=docker/dockerfile:1

 # ---- Dependencies stage ----
 ARG NODE_VERSION=24.3.0
 FROM node:${NODE_VERSION}-slim AS deps

 # Use root workspace lockfile to install backend dependencies
 WORKDIR /app
 COPY package.json package-lock.json ./
 COPY backend/package.json backend/package.json
 COPY shared/package.json shared/package.json
 RUN npm ci --include=dev --workspace backend

 # ---- Development stage ----
 FROM node:${NODE_VERSION}-slim AS base
 WORKDIR /app


 # Set default environment
 ENV NODE_ENV=development
 ENV CHOKIDAR_USEPOLLING=true

 # Copy installed modules and application code
 COPY --from=deps /app/node_modules ./node_modules
 COPY package.json package-lock.json ./
 COPY backend/ backend/
 COPY shared/ shared/

 # Expose application port
 EXPOSE 3000

 # Start development server with live reload
 CMD ["npm", "run", "start:dev"]
